import{r as t,h as e,H as r,g as i}from"./p-9ec43e93.js";const n={"X-Client-Info":"supabase-js/1.28.5"};var s,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const u=h((function(t,e){var r="undefined"!=typeof self?self:o,i=function(){function t(){this.fetch=!1,this.DOMException=r.DOMException}return t.prototype=r,new t}();!function(t){!function(e){var r="URLSearchParams"in t,i="Symbol"in t&&"iterator"in Symbol,n="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),s="FormData"in t,o="ArrayBuffer"in t;if(o)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(t){return t&&h.indexOf(Object.prototype.toString.call(t))>-1};function a(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function c(t){return"string"!=typeof t&&(t=String(t)),t}function l(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return i&&(e[Symbol.iterator]=function(){return e}),e}function d(t){this.map={},t instanceof d?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function f(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function v(t){return new Promise((function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}}))}function p(t){var e=new FileReader,r=v(e);return e.readAsArrayBuffer(t),r}function y(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function w(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:n&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:s&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:r&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():o&&n&&(e=t)&&DataView.prototype.isPrototypeOf(e)?(this._bodyArrayBuffer=y(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o&&(ArrayBuffer.prototype.isPrototypeOf(t)||u(t))?this._bodyArrayBuffer=y(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n&&(this.blob=function(){var t=f(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var t,e,r,i=f(this);if(i)return i;if(this._bodyBlob)return t=this._bodyBlob,r=v(e=new FileReader),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),i=0;i<e.length;i++)r[i]=String.fromCharCode(e[i]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(t,e){t=a(t),e=c(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},d.prototype.delete=function(t){delete this.map[a(t)]},d.prototype.get=function(t){return t=a(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(a(t))},d.prototype.set=function(t,e){this.map[a(t)]=c(e)},d.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},d.prototype.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),l(t)},d.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),l(t)},d.prototype.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),l(t)},i&&(d.prototype[Symbol.iterator]=d.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(t,e){var r,i,n=(e=e||{}).body;if(t instanceof b){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=(i=(r=e.method||this.method||"GET").toUpperCase(),m.indexOf(i)>-1?i:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function g(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var r=t.split("="),i=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(n))}})),e}function $(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},w.call(b.prototype),w.call($.prototype),$.prototype.clone=function(){return new $(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},$.error=function(){var t=new $(null,{status:0,statusText:""});return t.type="error",t};var E=[301,302,303,307,308];$.redirect=function(t,e){if(-1===E.indexOf(e))throw new RangeError("Invalid status code");return new $(null,{status:e,headers:{location:t}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function O(t,r){return new Promise((function(i,s){var o=new b(t,r);if(o.signal&&o.signal.aborted)return s(new e.DOMException("Aborted","AbortError"));var h=new XMLHttpRequest;function u(){h.abort()}h.onload=function(){var t,e,r={status:h.status,statusText:h.statusText,headers:(t=h.getAllResponseHeaders()||"",e=new d,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var r=t.split(":"),i=r.shift().trim();if(i){var n=r.join(":").trim();e.append(i,n)}})),e)};r.url="responseURL"in h?h.responseURL:r.headers.get("X-Request-URL"),i(new $("response"in h?h.response:h.responseText,r))},h.onerror=function(){s(new TypeError("Network request failed"))},h.ontimeout=function(){s(new TypeError("Network request failed"))},h.onabort=function(){s(new e.DOMException("Aborted","AbortError"))},h.open(o.method,o.url,!0),"include"===o.credentials?h.withCredentials=!0:"omit"===o.credentials&&(h.withCredentials=!1),"responseType"in h&&n&&(h.responseType="blob"),o.headers.forEach((function(t,e){h.setRequestHeader(e,t)})),o.signal&&(o.signal.addEventListener("abort",u),h.onreadystatechange=function(){4===h.readyState&&o.signal.removeEventListener("abort",u)}),h.send(void 0===o._bodyInit?null:o._bodyInit)}))}O.polyfill=!0,t.fetch||(t.fetch=O,t.Headers=d,t.Request=b,t.Response=$),e.Headers=d,e.Request=b,e.Response=$,e.fetch=O,Object.defineProperty(e,"__esModule",{value:!0})}({})}(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var n=i;(e=n.fetch).default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,t.exports=e}(s={path:undefined,exports:{},require:function(){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},s.exports),s.exports));var a=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function h(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}u((i=i.apply(t,e||[])).next())}))};const c=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t);function l(t=u,e,r,i,n){return a(this,void 0,void 0,(function*(){return new Promise(((s,o)=>{t(r,((t,e,r)=>{const i={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t||(i.headers=Object.assign({"Content-Type":"text/plain;charset=UTF-8"},null==e?void 0:e.headers),i.body=JSON.stringify(r)),i})(e,i,n)).then((t=>{if(!t.ok)throw t;return(null==i?void 0:i.noResolveJson)?s:t.json()})).then((t=>s(t))).catch((t=>((t,e)=>{if("function"!=typeof t.json)return e(t);t.json().then((r=>e({message:c(r),status:(null==t?void 0:t.status)||500})))})(t,o)))}))}))}function d(t,e,r){return a(this,void 0,void 0,(function*(){return l(t,"GET",e,r)}))}function f(t,e,r,i){return a(this,void 0,void 0,(function*(){return l(t,"POST",e,i,r)}))}const v="supabase.auth.token",p={name:"sb:token",lifetime:28800,domain:"",path:"/",sameSite:"lax"};function y(t,e,r){const i=r.map((e=>{return r=e,i=function(t){if(!t||!t.headers||!t.headers.host)throw new Error('The "host" request header is not available');const e=t.headers.host.indexOf(":")>-1&&t.headers.host.split(":")[0]||t.headers.host;return!(["localhost","127.0.0.1"].indexOf(e)>-1||e.endsWith(".local"))}(t),function(t,e,r){const i=r||{},n=encodeURIComponent,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;if("function"!=typeof n)throw new TypeError("option encode is invalid");if(!s.test(t))throw new TypeError("argument name is invalid");const o=n(e);if(o&&!s.test(o))throw new TypeError("argument val is invalid");let h=t+"="+o;if(null!=i.maxAge){const t=i.maxAge-0;if(isNaN(t)||!isFinite(t))throw new TypeError("option maxAge is invalid");h+="; Max-Age="+Math.floor(t)}if(i.domain){if(!s.test(i.domain))throw new TypeError("option domain is invalid");h+="; Domain="+i.domain}if(i.path){if(!s.test(i.path))throw new TypeError("option path is invalid");h+="; Path="+i.path}if(i.expires){if("function"!=typeof i.expires.toUTCString)throw new TypeError("option expires is invalid");h+="; Expires="+i.expires.toUTCString()}if(i.httpOnly&&(h+="; HttpOnly"),i.secure&&(h+="; Secure"),i.sameSite)switch("string"==typeof i.sameSite?i.sameSite.toLowerCase():i.sameSite){case"lax":h+="; SameSite=Lax";break;case"strict":h+="; SameSite=Strict";break;case"none":h+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return h}(r.name,r.value,{maxAge:r.maxAge,expires:new Date(Date.now()+1e3*r.maxAge),httpOnly:!0,secure:i,path:null!==(n=r.path)&&void 0!==n?n:"/",domain:null!==(s=r.domain)&&void 0!==s?s:"",sameSite:null!==(o=r.sameSite)&&void 0!==o?o:"lax"});var r,i,n,s,o})),n=e.getHeader("Set-Cookie");n&&(n instanceof Array?Array.prototype.push.apply(i,n):"string"==typeof n&&i.push(n)),e.setHeader("Set-Cookie",i)}function w(t,e,r){y(t,e,[r])}function m(t){return Math.round(Date.now()/1e3)+t}const b=()=>"undefined"!=typeof window;function g(t,e){var r;e||(e=(null===(r=null===window||void 0===window?void 0:window.location)||void 0===r?void 0:r.href)||""),t=t.replace(/[\[\]]/g,"\\$&");const i=new RegExp("[?&#]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}var $=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function h(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}u((i=i.apply(t,e||[])).next())}))};class E{constructor({url:t="",headers:e={},cookieOptions:r,fetch:i}){this.url=t,this.headers=e,this.cookieOptions=Object.assign(Object.assign({},p),r),this.fetch=i}createUser(t){return $(this,void 0,void 0,(function*(){try{return{data:yield f(this.fetch,`${this.url}/admin/users`,t,{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}}))}listUsers(){return $(this,void 0,void 0,(function*(){try{return{data:(yield d(this.fetch,`${this.url}/admin/users`,{headers:this.headers})).users,error:null}}catch(t){return{data:null,error:t}}}))}signUpWithEmail(t,e,r={}){return $(this,void 0,void 0,(function*(){try{const i=Object.assign({},this.headers);let n="";r.redirectTo&&(n="?redirect_to="+encodeURIComponent(r.redirectTo));const s=yield f(this.fetch,`${this.url}/signup${n}`,{email:t,password:e,data:r.data},{headers:i}),o=Object.assign({},s);return o.expires_in&&(o.expires_at=m(s.expires_in)),{data:o,error:null}}catch(t){return{data:null,error:t}}}))}signInWithEmail(t,e,r={}){return $(this,void 0,void 0,(function*(){try{const i=Object.assign({},this.headers);let n="?grant_type=password";r.redirectTo&&(n+="&redirect_to="+encodeURIComponent(r.redirectTo));const s=yield f(this.fetch,`${this.url}/token${n}`,{email:t,password:e},{headers:i}),o=Object.assign({},s);return o.expires_in&&(o.expires_at=m(s.expires_in)),{data:o,error:null}}catch(t){return{data:null,error:t}}}))}signUpWithPhone(t,e,r={}){return $(this,void 0,void 0,(function*(){try{const i=Object.assign({},this.headers),n=yield f(this.fetch,`${this.url}/signup`,{phone:t,password:e,data:r.data},{headers:i}),s=Object.assign({},n);return s.expires_in&&(s.expires_at=m(n.expires_in)),{data:s,error:null}}catch(t){return{data:null,error:t}}}))}signInWithPhone(t,e){return $(this,void 0,void 0,(function*(){try{const r=Object.assign({},this.headers),i="?grant_type=password",n=yield f(this.fetch,`${this.url}/token${i}`,{phone:t,password:e},{headers:r}),s=Object.assign({},n);return s.expires_in&&(s.expires_at=m(n.expires_in)),{data:s,error:null}}catch(t){return{data:null,error:t}}}))}sendMagicLinkEmail(t,e={}){return $(this,void 0,void 0,(function*(){try{const r=Object.assign({},this.headers);let i="";return e.redirectTo&&(i+="?redirect_to="+encodeURIComponent(e.redirectTo)),{data:yield f(this.fetch,`${this.url}/magiclink${i}`,{email:t},{headers:r}),error:null}}catch(t){return{data:null,error:t}}}))}sendMobileOTP(t){return $(this,void 0,void 0,(function*(){try{const e=Object.assign({},this.headers);return{data:yield f(this.fetch,`${this.url}/otp`,{phone:t},{headers:e}),error:null}}catch(t){return{data:null,error:t}}}))}verifyMobileOTP(t,e,r={}){return $(this,void 0,void 0,(function*(){try{const i=Object.assign({},this.headers);return{data:yield f(this.fetch,`${this.url}/verify`,{phone:t,token:e,type:"sms",redirect_to:r.redirectTo},{headers:i}),error:null}}catch(t){return{data:null,error:t}}}))}inviteUserByEmail(t,e={}){return $(this,void 0,void 0,(function*(){try{const r=Object.assign({},this.headers);let i="";return e.redirectTo&&(i+="?redirect_to="+encodeURIComponent(e.redirectTo)),{data:yield f(this.fetch,`${this.url}/invite${i}`,{email:t,data:e.data},{headers:r}),error:null}}catch(t){return{data:null,error:t}}}))}resetPasswordForEmail(t,e={}){return $(this,void 0,void 0,(function*(){try{const r=Object.assign({},this.headers);let i="";return e.redirectTo&&(i+="?redirect_to="+encodeURIComponent(e.redirectTo)),{data:yield f(this.fetch,`${this.url}/recover${i}`,{email:t},{headers:r}),error:null}}catch(t){return{data:null,error:t}}}))}_createRequestHeaders(t){const e=Object.assign({},this.headers);return e.Authorization=`Bearer ${t}`,e}signOut(t){return $(this,void 0,void 0,(function*(){try{return yield f(this.fetch,`${this.url}/logout`,{},{headers:this._createRequestHeaders(t),noResolveJson:!0}),{error:null}}catch(t){return{error:t}}}))}getUrlForProvider(t,e){const r=[`provider=${encodeURIComponent(t)}`];return(null==e?void 0:e.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(e.redirectTo)}`),(null==e?void 0:e.scopes)&&r.push(`scopes=${encodeURIComponent(e.scopes)}`),`${this.url}/authorize?${r.join("&")}`}getUser(t){return $(this,void 0,void 0,(function*(){try{const e=yield d(this.fetch,`${this.url}/user`,{headers:this._createRequestHeaders(t)});return{user:e,data:e,error:null}}catch(t){return{user:null,data:null,error:t}}}))}updateUser(t,e){return $(this,void 0,void 0,(function*(){try{const r=yield function(t,e,r,i){return a(this,void 0,void 0,(function*(){return l(t,"PUT",e,i,r)}))}(this.fetch,`${this.url}/user`,e,{headers:this._createRequestHeaders(t)});return{user:r,data:r,error:null}}catch(t){return{user:null,data:null,error:t}}}))}deleteUser(t,e){return $(this,void 0,void 0,(function*(){try{const r=yield function(t,e,r,i){return a(this,void 0,void 0,(function*(){return l(t,"DELETE",e,i,r)}))}(this.fetch,`${this.url}/admin/users/${t}`,{},{headers:this._createRequestHeaders(e)});return{user:r,data:r,error:null}}catch(t){return{user:null,data:null,error:t}}}))}refreshAccessToken(t){return $(this,void 0,void 0,(function*(){try{const e=yield f(this.fetch,`${this.url}/token?grant_type=refresh_token`,{refresh_token:t},{headers:this.headers}),r=Object.assign({},e);return r.expires_in&&(r.expires_at=m(e.expires_in)),{data:r,error:null}}catch(t){return{data:null,error:t}}}))}setAuthCookie(t,e){"POST"!==t.method&&(e.setHeader("Allow","POST"),e.status(405).end("Method Not Allowed"));const{event:r,session:i}=t.body;if(!r)throw new Error("Auth event missing!");if("SIGNED_IN"===r){if(!i)throw new Error("Auth session missing!");w(t,e,{name:this.cookieOptions.name,value:i.access_token,domain:this.cookieOptions.domain,maxAge:this.cookieOptions.lifetime,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite})}"SIGNED_OUT"===r&&function(t,e,r){w(t,e,{name:r,value:"",maxAge:-1})}(t,e,this.cookieOptions.name),e.status(200).json({})}getUserByCookie(t){return $(this,void 0,void 0,(function*(){try{if(!t.cookies)throw new Error("Not able to parse cookies! When using Express make sure the cookie-parser middleware is in use!");if(!t.cookies[this.cookieOptions.name])throw new Error("No cookie found!");const e=t.cookies[this.cookieOptions.name],{user:r,error:i}=yield this.getUser(e);if(i)throw i;return{token:e,user:r,data:r,error:null}}catch(t){return{token:null,user:null,data:null,error:t}}}))}generateLink(t,e,r={}){return $(this,void 0,void 0,(function*(){try{return{data:yield f(this.fetch,`${this.url}/admin/generate_link`,{type:t,email:e,password:r.password,data:r.data,redirect_to:r.redirectTo},{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}}))}}var O=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function h(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}u((i=i.apply(t,e||[])).next())}))};!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(t){"undefined"!=typeof self&&(self.globalThis=self)}}();const S={url:"http://localhost:9999",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:{"X-Client-Info":"gotrue-js/1.21.7"}};class T extends class{constructor(t){this.stateChangeEmitters=new Map;const e=Object.assign(Object.assign({},S),t);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=e.autoRefreshToken,this.persistSession=e.persistSession,this.multiTab=e.multiTab,this.localStorage=e.localStorage||globalThis.localStorage,this.api=new E({url:e.url,headers:e.headers,cookieOptions:e.cookieOptions,fetch:e.fetch}),this._recoverSession(),this._recoverAndRefresh(),this._listenForMultiTabEvents(),e.detectSessionInUrl&&b()&&g("access_token")&&this.getSessionFromUrl({storeSession:!0}).then((({error:t})=>{t&&console.error("Error getting session from URL.",t)}))}signUp({email:t,password:e,phone:r},i={}){return O(this,void 0,void 0,(function*(){try{this._removeSession();const{data:n,error:s}=r&&e?yield this.api.signUpWithPhone(r,e,{data:i.data}):yield this.api.signUpWithEmail(t,e,{redirectTo:i.redirectTo,data:i.data});if(s)throw s;if(!n)throw"An error occurred on sign up.";let o=null,h=null;return n.access_token&&(o=n,h=o.user,this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN")),n.id&&(h=n),{user:h,session:o,error:null}}catch(t){return{user:null,session:null,error:t}}}))}signIn({email:t,phone:e,password:r,refreshToken:i,provider:n},s={}){return O(this,void 0,void 0,(function*(){try{if(this._removeSession(),t&&!r){const{error:e}=yield this.api.sendMagicLinkEmail(t,{redirectTo:s.redirectTo});return{user:null,session:null,error:e}}if(t&&r)return this._handleEmailSignIn(t,r,{redirectTo:s.redirectTo});if(e&&!r){const{error:t}=yield this.api.sendMobileOTP(e);return{user:null,session:null,error:t}}if(e&&r)return this._handlePhoneSignIn(e,r);if(i){const{error:t}=yield this._callRefreshToken(i);if(t)throw t;return{user:this.currentUser,session:this.currentSession,error:null}}if(n)return this._handleProviderSignIn(n,{redirectTo:s.redirectTo,scopes:s.scopes});throw new Error("You must provide either an email, phone number or a third-party provider.")}catch(t){return{user:null,session:null,error:t}}}))}verifyOTP({phone:t,token:e},r={}){return O(this,void 0,void 0,(function*(){try{this._removeSession();const{data:i,error:n}=yield this.api.verifyMobileOTP(t,e,r);if(n)throw n;if(!i)throw"An error occurred on token verification.";let s=null,o=null;return i.access_token&&(s=i,o=s.user,this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN")),i.id&&(o=i),{user:o,session:s,error:null}}catch(t){return{user:null,session:null,error:t}}}))}user(){return this.currentUser}session(){return this.currentSession}refreshSession(){var t;return O(this,void 0,void 0,(function*(){try{if(!(null===(t=this.currentSession)||void 0===t?void 0:t.access_token))throw new Error("Not logged in.");const{error:e}=yield this._callRefreshToken();if(e)throw e;return{data:this.currentSession,user:this.currentUser,error:null}}catch(t){return{data:null,user:null,error:t}}}))}update(t){var e;return O(this,void 0,void 0,(function*(){try{if(!(null===(e=this.currentSession)||void 0===e?void 0:e.access_token))throw new Error("Not logged in.");const{user:r,error:i}=yield this.api.updateUser(this.currentSession.access_token,t);if(i)throw i;if(!r)throw Error("Invalid user data.");const n=Object.assign(Object.assign({},this.currentSession),{user:r});return this._saveSession(n),this._notifyAllSubscribers("USER_UPDATED"),{data:r,user:r,error:null}}catch(t){return{data:null,user:null,error:t}}}))}setSession(t){return O(this,void 0,void 0,(function*(){try{if(!t)throw new Error("No current session.");const{data:e,error:r}=yield this.api.refreshAccessToken(t);return r?{session:null,error:r}:(this._saveSession(e),this._notifyAllSubscribers("SIGNED_IN"),{session:e,error:null})}catch(t){return{error:t,session:null}}}))}setAuth(t){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:t,token_type:"bearer",user:null}),this.currentSession}getSessionFromUrl(t){return O(this,void 0,void 0,(function*(){try{if(!b())throw new Error("No browser detected.");const e=g("error_description");if(e)throw new Error(e);const r=g("provider_token"),i=g("access_token");if(!i)throw new Error("No access_token detected.");const n=g("expires_in");if(!n)throw new Error("No expires_in detected.");const s=g("refresh_token");if(!s)throw new Error("No refresh_token detected.");const o=g("token_type");if(!o)throw new Error("No token_type detected.");const h=Math.round(Date.now()/1e3)+parseInt(n),{user:u,error:a}=yield this.api.getUser(i);if(a)throw a;const c={provider_token:r,access_token:i,expires_in:parseInt(n),expires_at:h,refresh_token:s,token_type:o,user:u};if(null==t?void 0:t.storeSession){this._saveSession(c);const t=g("type");this._notifyAllSubscribers("SIGNED_IN"),"recovery"===t&&this._notifyAllSubscribers("PASSWORD_RECOVERY")}return window.location.hash="",{data:c,error:null}}catch(t){return{data:null,error:t}}}))}signOut(){var t;return O(this,void 0,void 0,(function*(){const e=null===(t=this.currentSession)||void 0===t?void 0:t.access_token;if(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"),e){const{error:t}=yield this.api.signOut(e);if(t)return{error:t}}return{error:null}}))}onAuthStateChange(t){try{const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})),r={id:e,callback:t,unsubscribe:()=>{this.stateChangeEmitters.delete(e)}};return this.stateChangeEmitters.set(e,r),{data:r,error:null}}catch(t){return{data:null,error:t}}}_handleEmailSignIn(t,e,r={}){var i,n;return O(this,void 0,void 0,(function*(){try{const{data:s,error:o}=yield this.api.signInWithEmail(t,e,{redirectTo:r.redirectTo});return o||!s?{data:null,user:null,session:null,error:o}:(((null===(i=null==s?void 0:s.user)||void 0===i?void 0:i.confirmed_at)||(null===(n=null==s?void 0:s.user)||void 0===n?void 0:n.email_confirmed_at))&&(this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN")),{data:s,user:s.user,session:s,error:null})}catch(t){return{data:null,user:null,session:null,error:t}}}))}_handlePhoneSignIn(t,e){var r;return O(this,void 0,void 0,(function*(){try{const{data:i,error:n}=yield this.api.signInWithPhone(t,e);return n||!i?{data:null,user:null,session:null,error:n}:((null===(r=null==i?void 0:i.user)||void 0===r?void 0:r.phone_confirmed_at)&&(this._saveSession(i),this._notifyAllSubscribers("SIGNED_IN")),{data:i,user:i.user,session:i,error:null})}catch(t){return{data:null,user:null,session:null,error:t}}}))}_handleProviderSignIn(t,e={}){const r=this.api.getUrlForProvider(t,{redirectTo:e.redirectTo,scopes:e.scopes});try{return b()&&(window.location.href=r),{provider:t,url:r,data:null,session:null,user:null,error:null}}catch(e){return r?{provider:t,url:r,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:e}}}_recoverSession(){var t;try{const e=b()&&(null===(t=this.localStorage)||void 0===t?void 0:t.getItem(v));if(!e||"string"!=typeof e)return null;const r=JSON.parse(e),{currentSession:i,expiresAt:n}=r;n>=Math.round(Date.now()/1e3)&&(null==i?void 0:i.user)&&(this._saveSession(i),this._notifyAllSubscribers("SIGNED_IN"))}catch(t){console.log("error",t)}}_recoverAndRefresh(){return O(this,void 0,void 0,(function*(){try{const t=b()&&(yield this.localStorage.getItem(v));if(!t)return null;const e=JSON.parse(t),{currentSession:r,expiresAt:i}=e;if(i<Math.round(Date.now()/1e3))if(this.autoRefreshToken&&r.refresh_token){const{error:t}=yield this._callRefreshToken(r.refresh_token);t&&(console.log(t.message),yield this._removeSession())}else this._removeSession();else r&&r.user?(this._saveSession(r),this._notifyAllSubscribers("SIGNED_IN")):(console.log("Current session is missing data."),this._removeSession())}catch(t){return console.error(t),null}}))}_callRefreshToken(t){var e;return void 0===t&&(t=null===(e=this.currentSession)||void 0===e?void 0:e.refresh_token),O(this,void 0,void 0,(function*(){try{if(!t)throw new Error("No current session.");const{data:e,error:r}=yield this.api.refreshAccessToken(t);if(r)throw r;if(!e)throw Error("Invalid session data.");return this._saveSession(e),this._notifyAllSubscribers("TOKEN_REFRESHED"),this._notifyAllSubscribers("SIGNED_IN"),{data:e,error:null}}catch(t){return{data:null,error:t}}}))}_notifyAllSubscribers(t){this.stateChangeEmitters.forEach((e=>e.callback(t,this.currentSession)))}_saveSession(t){this.currentSession=t,this.currentUser=t.user;const e=t.expires_at;if(e){const t=e-Math.round(Date.now()/1e3);this._startAutoRefreshToken(1e3*(t-(t>60?60:.5)))}this.persistSession&&t.expires_at&&this._persistSession(this.currentSession)}_persistSession(t){const e={currentSession:t,expiresAt:t.expires_at};b()&&this.localStorage.setItem(v,JSON.stringify(e))}_removeSession(){return O(this,void 0,void 0,(function*(){this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),b()&&(yield this.localStorage.removeItem(v))}))}_startAutoRefreshToken(t){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),t<=0||!this.autoRefreshToken||(this.refreshTokenTimer=setTimeout((()=>this._callRefreshToken()),t),"function"==typeof this.refreshTokenTimer.unref&&this.refreshTokenTimer.unref())}_listenForMultiTabEvents(){if(!this.multiTab||!b()||!(null===window||void 0===window?void 0:window.addEventListener))return!1;try{null===window||void 0===window||window.addEventListener("storage",(t=>{var e;if(t.key===v){const r=JSON.parse(String(t.newValue));(null===(e=null==r?void 0:r.currentSession)||void 0===e?void 0:e.access_token)?(this._recoverAndRefresh(),this._notifyAllSubscribers("SIGNED_IN")):(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"))}}))}catch(t){console.error("_listenForMultiTabEvents",t)}}}{constructor(t){super(t)}}class _{constructor(t){this.shouldThrowOnError=!1,Object.assign(this,t),this.fetch=t.fetch||u}throwOnError(){return this.shouldThrowOnError=!0,this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let r=this.fetch(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((t=>{return e=this,r=void 0,n=function*(){var e,r,i;let n=null,s=null,o=null;if(t.ok){const n=null===(e=this.headers.Prefer)||void 0===e?void 0:e.split(",").includes("return=minimal");if("HEAD"!==this.method&&!n){const e=yield t.text();e&&(s="text/csv"===this.headers.Accept?e:JSON.parse(e))}const h=null===(r=this.headers.Prefer)||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),u=null===(i=t.headers.get("content-range"))||void 0===i?void 0:i.split("/");h&&u&&u.length>1&&(o=parseInt(u[1]))}else if(n=yield t.json(),n&&this.shouldThrowOnError)throw n;return{error:n,data:s,count:o,status:t.status,statusText:t.statusText,body:s}},new((i=void 0)||(i=Promise))((function(t,s){function o(t){try{u(n.next(t))}catch(t){s(t)}}function h(t){try{u(n.throw(t))}catch(t){s(t)}}function u(e){var r;e.done?t(e.value):(r=e.value,r instanceof i?r:new i((function(t){t(r)}))).then(o,h)}u((n=n.apply(e,r||[])).next())}));var e,r,i,n}));return this.shouldThrowOnError||(r=r.catch((t=>({error:{message:`FetchError: ${t.message}`,details:"",hint:"",code:t.code||""},data:null,body:null,count:null,status:400,statusText:"Bad Request"})))),r.then(t,e)}}class j extends _{select(t="*"){let e=!1;const r=t.split("").map((t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t))).join("");return this.url.searchParams.set("select",r),this}order(t,{ascending:e=!0,nullsFirst:r=!1,foreignTable:i}={}){const n=void 0===i?"order":`${i}.order`,s=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${s?`${s},`:""}${t}.${e?"asc":"desc"}.${r?"nullsfirst":"nullslast"}`),this}limit(t,{foreignTable:e}={}){return this.url.searchParams.set(void 0===e?"limit":`${e}.limit`,`${t}`),this}range(t,e,{foreignTable:r}={}){const i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(void 0===r?"offset":`${r}.offset`,`${t}`),this.url.searchParams.set(i,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){this.headers.Accept="application/vnd.pgrst.object+json";const t=new j(this);return t.then=(t,e)=>this.then((e=>{var r,i;return(null===(i=null===(r=e.error)||void 0===r?void 0:r.details)||void 0===i?void 0:i.includes("Results contain 0 rows"))?t({error:null,data:null,count:e.count,status:200,statusText:"OK",body:null}):t(e)}),e),t}csv(){return this.headers.Accept="text/csv",this}}class x extends j{constructor(){super(...arguments),this.cs=this.contains,this.cd=this.containedBy,this.sl=this.rangeLt,this.sr=this.rangeGt,this.nxl=this.rangeGte,this.nxr=this.rangeLte,this.adj=this.rangeAdjacent,this.ov=this.overlaps}not(t,e,r){return this.url.searchParams.append(`${t}`,`not.${e}.${r}`),this}or(t,{foreignTable:e}={}){return this.url.searchParams.append(void 0===e?"or":`${e}.or`,`(${t})`),this}eq(t,e){return this.url.searchParams.append(`${t}`,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(`${t}`,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(`${t}`,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(`${t}`,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(`${t}`,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(`${t}`,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(`${t}`,`like.${e}`),this}ilike(t,e){return this.url.searchParams.append(`${t}`,`ilike.${e}`),this}is(t,e){return this.url.searchParams.append(`${t}`,`is.${e}`),this}in(t,e){const r=e.map((t=>"string"==typeof t&&new RegExp("[,()]").test(t)?`"${t}"`:`${t}`)).join(",");return this.url.searchParams.append(`${t}`,`in.(${r})`),this}contains(t,e){return"string"==typeof e?this.url.searchParams.append(`${t}`,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(`${t}`,`cs.{${e.join(",")}}`):this.url.searchParams.append(`${t}`,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return"string"==typeof e?this.url.searchParams.append(`${t}`,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(`${t}`,`cd.{${e.join(",")}}`):this.url.searchParams.append(`${t}`,`cd.${JSON.stringify(e)}`),this}rangeLt(t,e){return this.url.searchParams.append(`${t}`,`sl.${e}`),this}rangeGt(t,e){return this.url.searchParams.append(`${t}`,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(`${t}`,`nxl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(`${t}`,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(`${t}`,`adj.${e}`),this}overlaps(t,e){return this.url.searchParams.append(`${t}`,"string"==typeof e?`ov.${e}`:`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:i=null}={}){let n="";return"plain"===i?n="pl":"phrase"===i?n="ph":"websearch"===i&&(n="w"),this.url.searchParams.append(`${t}`,`${n}fts${void 0===r?"":`(${r})`}.${e}`),this}fts(t,e,{config:r}={}){return this.url.searchParams.append(`${t}`,`fts${void 0===r?"":`(${r})`}.${e}`),this}plfts(t,e,{config:r}={}){return this.url.searchParams.append(`${t}`,`plfts${void 0===r?"":`(${r})`}.${e}`),this}phfts(t,e,{config:r}={}){return this.url.searchParams.append(`${t}`,`phfts${void 0===r?"":`(${r})`}.${e}`),this}wfts(t,e,{config:r}={}){return this.url.searchParams.append(`${t}`,`wfts${void 0===r?"":`(${r})`}.${e}`),this}filter(t,e,r){return this.url.searchParams.append(`${t}`,`${e}.${r}`),this}match(t){return Object.keys(t).forEach((e=>{this.url.searchParams.append(`${e}`,`eq.${t[e]}`)})),this}}class k extends _{constructor(t,{headers:e={},schema:r,fetch:i}={}){super({fetch:i}),this.url=new URL(t),this.headers=Object.assign({},e),this.schema=r}select(t="*",{head:e=!1,count:r=null}={}){this.method="GET";let i=!1;const n=t.split("").map((t=>/\s/.test(t)&&!i?"":('"'===t&&(i=!i),t))).join("");return this.url.searchParams.set("select",n),r&&(this.headers.Prefer=`count=${r}`),e&&(this.method="HEAD"),new x(this)}insert(t,{upsert:e=!1,onConflict:r,returning:i="representation",count:n=null}={}){this.method="POST";const s=[`return=${i}`];if(e&&s.push("resolution=merge-duplicates"),e&&void 0!==r&&this.url.searchParams.set("on_conflict",r),this.body=t,n&&s.push(`count=${n}`),this.headers.Prefer=s.join(","),Array.isArray(t)){const e=t.reduce(((t,e)=>t.concat(Object.keys(e))),[]);if(e.length>0){const t=[...new Set(e)].map((t=>`"${t}"`));this.url.searchParams.set("columns",t.join(","))}}return new x(this)}upsert(t,{onConflict:e,returning:r="representation",count:i=null,ignoreDuplicates:n=!1}={}){this.method="POST";const s=[`resolution=${n?"ignore":"merge"}-duplicates`,`return=${r}`];return void 0!==e&&this.url.searchParams.set("on_conflict",e),this.body=t,i&&s.push(`count=${i}`),this.headers.Prefer=s.join(","),new x(this)}update(t,{returning:e="representation",count:r=null}={}){this.method="PATCH";const i=[`return=${e}`];return this.body=t,r&&i.push(`count=${r}`),this.headers.Prefer=i.join(","),new x(this)}delete({returning:t="representation",count:e=null}={}){this.method="DELETE";const r=[`return=${t}`];return e&&r.push(`count=${e}`),this.headers.Prefer=r.join(","),new x(this)}}class I extends _{constructor(t,{headers:e={},schema:r,fetch:i}={}){super({fetch:i}),this.url=new URL(t),this.headers=Object.assign({},e),this.schema=r}rpc(t,{head:e=!1,count:r=null}={}){return e?(this.method="HEAD",t&&Object.entries(t).forEach((([t,e])=>{this.url.searchParams.append(t,e)}))):(this.method="POST",this.body=t),r&&(void 0!==this.headers.Prefer?this.headers.Prefer+=`,count=${r}`:this.headers.Prefer=`count=${r}`),new x(this)}}const N={"X-Client-Info":"postgrest-js/0.35.0"};class R{constructor(t,{headers:e={},schema:r,fetch:i}={}){this.url=t,this.headers=Object.assign(Object.assign({},N),e),this.schema=r,this.fetch=i}auth(t){return this.headers.Authorization=`Bearer ${t}`,this}from(t){return new k(`${this.url}/${t}`,{headers:this.headers,schema:this.schema,fetch:this.fetch})}rpc(t,e,{head:r=!1,count:i=null}={}){return new I(`${this.url}/rpc/${t}`,{headers:this.headers,schema:this.schema,fetch:this.fetch}).rpc(e,{head:r,count:i})}}var U;!function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"}(U||(U={}));const A=(t,e,r={})=>{var i;const n=null!==(i=r.skipTypes)&&void 0!==i?i:[];return Object.keys(e).reduce(((r,i)=>(r[i]=P(i,t,e,n),r)),{})},P=(t,e,r,i)=>{const n=e.find((e=>e.name===t)),s=null==n?void 0:n.type,o=r[t];return s&&!i.includes(s)?C(s,o):D(o)},C=(t,e)=>{if("_"===t.charAt(0)){const r=t.slice(1,t.length);return L(e,r)}switch(t){case U.bool:return G(e);case U.float4:case U.float8:case U.int2:case U.int4:case U.int8:case U.numeric:case U.oid:return B(e);case U.json:case U.jsonb:return F(e);case U.timestamp:return J(e);case U.abstime:case U.date:case U.daterange:case U.int4range:case U.int8range:case U.money:case U.reltime:case U.text:case U.time:case U.timestamptz:case U.timetz:case U.tsrange:case U.tstzrange:default:return D(e)}},D=t=>t,G=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},B=t=>{if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},F=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},L=(t,e)=>{if("string"!=typeof t)return t;const r=t.length-1;if("{"===t[0]&&"}"===t[r]){let i;const n=t.slice(1,r);try{i=JSON.parse("["+n+"]")}catch(t){i=n?n.split(","):[]}return i.map((t=>C(e,t)))}return t},J=t=>"string"==typeof t?t.replace(" ","T"):t,M={"X-Client-Info":"realtime-js/1.3.3"};var H,q,K,z;!function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"}(H||(H={})),function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"}(q||(q={})),function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"}(K||(K={})),function(t){t.websocket="websocket"}(z||(z={}));class W{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}class X{constructor(t,e,r={},i=1e4){this.channel=t,this.event=e,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}receive(t,e){var r;return this._hasReceived(t)&&e(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,(t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout))}trigger(t,e){this.refEvent&&this.channel.trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter((e=>e.status===t)).forEach((t=>t.callback(e)))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}class V{constructor(t,e={},r){this.topic=t,this.params=e,this.socket=r,this.bindings=[],this.state=q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new X(this,K.join,this.params,this.timeout),this.rejoinTimer=new W((()=>this.rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((t=>t.send())),this.pushBuffer=[]})),this.onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=q.closed,this.socket.remove(this)})),this.onError((t=>{this.isLeaving()||this.isClosed()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=q.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this.isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=q.errored,this.rejoinTimer.scheduleTimeout())})),this.on(K.reply,((t,e)=>{this.trigger(this.replyEventName(e),t)}))}rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}subscribe(t=this.timeout){if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(t),this.joinPush}onClose(t){this.on(K.close,t)}onError(t){this.on(K.error,(e=>t(e)))}on(t,e){this.bindings.push({event:t,callback:e})}off(t){this.bindings=this.bindings.filter((e=>e.event!==t))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(t,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new X(this,t,e,r);return this.canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}unsubscribe(t=this.timeout){this.state=q.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this.trigger(K.close,"leave",this.joinRef())};this.joinPush.destroy();let r=new X(this,K.leave,{},t);return r.receive("ok",(()=>e())).receive("timeout",(()=>e())),r.send(),this.canPush()||r.trigger("ok",{}),r}onMessage(t,e,r){return e}isMember(t){return this.topic===t}joinRef(){return this.joinPush.ref}sendJoin(t){this.state=q.joining,this.joinPush.resend(t)}rejoin(t=this.timeout){this.isLeaving()||this.sendJoin(t)}trigger(t,e,r){let{close:i,error:n,leave:s,join:o}=K;if(r&&[i,n,s,o].indexOf(t)>=0&&r!==this.joinRef())return;let h=this.onMessage(t,e,r);if(e&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter((r=>"*"===r.event?t===(null==e?void 0:e.type):r.event===t)).map((t=>t.callback(h,r)))}replyEventName(t){return`chan_reply_${t}`}isClosed(){return this.state===q.closed}isErrored(){return this.state===q.errored}isJoined(){return this.state===q.joined}isJoining(){return this.state===q.joining}isLeaving(){return this.state===q.leaving}}var Y,Q=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")},Z=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(t){return Q()}try{return __global__||Q()}finally{delete Object.prototype.__global__}}();if("object"==typeof globalThis)Y=globalThis;else try{Y=Z}catch(t){}finally{if(Y||"undefined"==typeof window||(Y=window),!Y)throw new Error("Could not determine global this")}var tt=Y.WebSocket||Y.MozWebSocket;function et(t,e){return e?new tt(t,e):new tt(t)}tt&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(t){Object.defineProperty(et,t,{get:function(){return tt[t]}})}));var rt={w3cwebsocket:tt?et:null,version:"1.0.34"};class it{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e("string"==typeof t?JSON.parse(t):{})}_binaryDecode(t){const e=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,e,r)}_decodeBroadcast(t,e,r){const i=e.getUint8(1),n=e.getUint8(2);let s=this.HEADER_LENGTH+2;const o=r.decode(t.slice(s,s+i));s+=i;const h=r.decode(t.slice(s,s+n));return s+=n,{ref:null,topic:o,event:h,payload:JSON.parse(r.decode(t.slice(s,t.byteLength)))}}}const nt=()=>{};class st{constructor(t,e){this.accessToken=null,this.channels=[],this.endPoint="",this.headers=M,this.params={},this.timeout=1e4,this.transport=rt.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=nt,this.conn=null,this.sendBuffer=[],this.serializer=new it,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint=`${t}/${z.websocket}`,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),(null==e?void 0:e.timeout)&&(this.timeout=e.timeout),(null==e?void 0:e.logger)&&(this.logger=e.logger),(null==e?void 0:e.transport)&&(this.transport=e.transport),(null==e?void 0:e.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs),(null==e?void 0:e.longpollerTimeout)&&(this.longpollerTimeout=e.longpollerTimeout),this.reconnectAfterMs=(null==e?void 0:e.reconnectAfterMs)?e.reconnectAfterMs:t=>[1e3,2e3,5e3,1e4][t-1]||1e4,this.encode=(null==e?void 0:e.encode)?e.encode:(t,e)=>e(JSON.stringify(t)),this.decode=(null==e?void 0:e.decode)?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new W((()=>{return t=this,e=void 0,i=function*(){yield this.disconnect(),this.connect()},new((r=void 0)||(r=Promise))((function(n,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function h(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}u((i=i.apply(t,e||[])).next())}));var t,e,r,i}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this.onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t)))}disconnect(t,e){return new Promise((r=>{try{this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,e||""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset()),r({error:null,data:!0})}catch(t){r({error:t,data:!1})}}))}log(t,e,r){this.logger(t,e,r)}onOpen(t){this.stateChangeCallbacks.open.push(t)}onClose(t){this.stateChangeCallbacks.close.push(t)}onError(t){this.stateChangeCallbacks.error.push(t)}onMessage(t){this.stateChangeCallbacks.message.push(t)}connectionState(){switch(this.conn&&this.conn.readyState){case H.connecting:return"connecting";case H.open:return"open";case H.closing:return"closing";default:return"closed"}}isConnected(){return"open"===this.connectionState()}remove(t){this.channels=this.channels.filter((e=>e.joinRef()!==t.joinRef()))}channel(t,e={}){let r=new V(t,e,this);return this.channels.push(r),r}push(t){let{topic:e,event:r,payload:i,ref:n}=t,s=()=>{this.encode(t,(t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)}))};this.log("push",`${e} ${r} (${n})`,i),this.isConnected()?s():this.sendBuffer.push(s)}onConnMessage(t){this.decode(t.data,(t=>{let{topic:e,event:r,payload:i,ref:n}=t;n&&n===this.pendingHeartbeatRef?this.pendingHeartbeatRef=null:r===(null==i?void 0:i.type)&&this._resetHeartbeat(),this.log("receive",`${i.status||""} ${e} ${r} ${n&&"("+n+")"||""}`,i),this.channels.filter((t=>t.isMember(e))).forEach((t=>t.trigger(r,i,n))),this.stateChangeCallbacks.message.forEach((e=>e(t)))}))}endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}makeRef(){let t=this.ref+1;return this.ref=t===this.ref?0:t,this.ref.toString()}setAuth(t){this.accessToken=t;try{this.channels.forEach((e=>e.joinedOnce&&e.isJoined()&&e.push(K.access_token,{access_token:t})))}catch(t){console.log("error",t),console.log("error",t),console.log("error",t)}}_onConnOpen(){this.log("transport",`connected to ${this.endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this._resetHeartbeat(),this.stateChangeCallbacks.open.forEach((t=>t()))}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((e=>e(t)))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((e=>e(t)))}_triggerChanError(){this.channels.forEach((t=>t.trigger(K.error)))}_appendParams(t,e){if(0===Object.keys(e).length)return t;const r=t.match(/\?/)?"&":"?";return`${t}${r}${new URLSearchParams(e)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((t=>t())),this.sendBuffer=[])}_resetHeartbeat(){this.pendingHeartbeatRef=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this._sendHeartbeat()),this.heartbeatIntervalMs)}_sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(t=this.conn)||void 0===t||t.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class ot{constructor(t,e,r,i){const n={},s="*"===i?`realtime:${r}`:`realtime:${r}:${i}`,o=e.Authorization.split(" ")[1];o&&(n.user_token=o),this.subscription=t.channel(s,n)}getPayloadRecords(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=A(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=A(t.columns,t.old_record)),e}on(t,e){return this.subscription.on(t,(t=>{let r={schema:t.schema,table:t.table,commit_timestamp:t.commit_timestamp,eventType:t.type,new:{},old:{}};r=Object.assign(Object.assign({},r),this.getPayloadRecords(t)),e(r)})),this}subscribe(t=(()=>{})){return this.subscription.onError((e=>t("SUBSCRIPTION_ERROR",e))),this.subscription.onClose((()=>t("CLOSED"))),this.subscription.subscribe().receive("ok",(()=>t("SUBSCRIBED"))).receive("error",(e=>t("SUBSCRIPTION_ERROR",e))).receive("timeout",(()=>t("RETRYING_AFTER_TIMEOUT"))),this.subscription}}class ht extends k{constructor(t,{headers:e={},schema:r,realtime:i,table:n,fetch:s}){super(t,{headers:e,schema:r,fetch:s}),this._subscription=new ot(i,e,r,n),this._realtime=i}on(t,e){return this._realtime.isConnected()||this._realtime.connect(),this._subscription.on(t,e)}}var ut=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function h(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}u((i=i.apply(t,e||[])).next())}))};const at=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t);function ct(t=u,e,r,i,n,s){return ut(this,void 0,void 0,(function*(){return new Promise(((o,h)=>{t(r,((t,e,r,i)=>{const n={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),n.body=JSON.stringify(i),Object.assign(Object.assign({},n),r))})(e,i,n,s)).then((t=>{if(!t.ok)throw t;return(null==i?void 0:i.noResolveJson)?o(t):t.json()})).then((t=>o(t))).catch((t=>((t,e)=>{if("function"!=typeof t.json)return e(t);t.json().then((r=>e({message:at(r),status:(null==t?void 0:t.status)||500})))})(t,h)))}))}))}function lt(t,e,r,i){return ut(this,void 0,void 0,(function*(){return ct(t,"GET",e,r,i)}))}function dt(t,e,r,i,n){return ut(this,void 0,void 0,(function*(){return ct(t,"POST",e,i,n,r)}))}function ft(t,e,r,i,n){return ut(this,void 0,void 0,(function*(){return ct(t,"DELETE",e,i,n,r)}))}const vt={"X-Client-Info":"storage-js/0.0.0"};var pt=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function h(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}u((i=i.apply(t,e||[])).next())}))},yt=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function h(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}u((i=i.apply(t,e||[])).next())}))};const wt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},mt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class bt{constructor(t,e={},r,i){this.url=t,this.headers=e,this.bucketId=r,this.fetch=i}uploadOrUpdate(t,e,r,i){return yt(this,void 0,void 0,(function*(){try{let n;const s=Object.assign(Object.assign({},mt),i),o=Object.assign(Object.assign({},this.headers),"POST"===t&&{"x-upsert":String(s.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",s.cacheControl),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",s.cacheControl)):(n=r,o["cache-control"]=`max-age=${s.cacheControl}`,o["content-type"]=s.contentType);const h=this._getFinalPath(e),a=yield u(`${this.url}/object/${h}`,{method:t,body:n,headers:o});return a.ok?{data:{Key:h},error:null}:{data:null,error:yield a.json()}}catch(t){return{data:null,error:t}}}))}upload(t,e,r){return yt(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",t,e,r)}))}update(t,e,r){return yt(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",t,e,r)}))}move(t,e){return yt(this,void 0,void 0,(function*(){try{return{data:yield dt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e},{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}}))}createSignedUrl(t,e){return yt(this,void 0,void 0,(function*(){try{const r=this._getFinalPath(t);let i=yield dt(this.fetch,`${this.url}/object/sign/${r}`,{expiresIn:e},{headers:this.headers});const n=`${this.url}${i.signedURL}`;return i={signedURL:n},{data:i,error:null,signedURL:n}}catch(t){return{data:null,error:t,signedURL:null}}}))}download(t){return yt(this,void 0,void 0,(function*(){try{const e=this._getFinalPath(t),r=yield lt(this.fetch,`${this.url}/object/${e}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(t){return{data:null,error:t}}}))}getPublicUrl(t){try{const e=this._getFinalPath(t),r=`${this.url}/object/public/${e}`;return{data:{publicURL:r},error:null,publicURL:r}}catch(t){return{data:null,error:t,publicURL:null}}}remove(t){return yt(this,void 0,void 0,(function*(){try{return{data:yield ft(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}}))}list(t,e,r){return yt(this,void 0,void 0,(function*(){try{const i=Object.assign(Object.assign(Object.assign({},wt),e),{prefix:t||""});return{data:yield dt(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(t){return{data:null,error:t}}}))}_getFinalPath(t){return`${this.bucketId}/${t}`}}class gt extends class{constructor(t,e={},r){this.url=t,this.headers=Object.assign(Object.assign({},vt),e),this.fetch=r}listBuckets(){return pt(this,void 0,void 0,(function*(){try{return{data:yield lt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}}))}getBucket(t){return pt(this,void 0,void 0,(function*(){try{return{data:yield lt(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}}))}createBucket(t,e={public:!1}){return pt(this,void 0,void 0,(function*(){try{return{data:(yield dt(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:e.public},{headers:this.headers})).name,error:null}}catch(t){return{data:null,error:t}}}))}updateBucket(t,e){return pt(this,void 0,void 0,(function*(){try{return{data:yield function(t,e,r,i){return ut(this,void 0,void 0,(function*(){return ct(t,"PUT",e,i,undefined,r)}))}(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public},{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}}))}emptyBucket(t){return pt(this,void 0,void 0,(function*(){try{return{data:yield dt(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}}))}deleteBucket(t){return pt(this,void 0,void 0,(function*(){try{return{data:yield ft(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}}))}}{constructor(t,e={},r){super(t,e,r)}from(t){return new bt(this.url,this.headers,t,this.fetch)}}var $t=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function h(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}u((i=i.apply(t,e||[])).next())}))};const Et={schema:"public",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:n};class Ot{constructor(t,e,r){if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");t=t.replace(/\/$/,"");const i=Object.assign(Object.assign({},Et),r);this.restUrl=`${t}/rest/v1`,this.realtimeUrl=`${t}/realtime/v1`.replace("http","ws"),this.authUrl=`${t}/auth/v1`,this.storageUrl=`${t}/storage/v1`,this.schema=i.schema,this.multiTab=i.multiTab,this.fetch=i.fetch,this.headers=Object.assign(Object.assign({},n),null==r?void 0:r.headers),this.auth=this._initSupabaseAuthClient(i),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},i.realtime)),this._listenForAuthEvents(),this._listenForMultiTabEvents()}get storage(){return new gt(this.storageUrl,this._getAuthHeaders(),this.fetch)}from(t){return new ht(`${this.restUrl}/${t}`,{headers:this._getAuthHeaders(),schema:this.schema,realtime:this.realtime,table:t,fetch:this.fetch})}rpc(t,e,{head:r=!1,count:i=null}={}){return this._initPostgRESTClient().rpc(t,e,{head:r,count:i})}removeAllSubscriptions(){this.realtime.channels.forEach((t=>{this.removeSubscription(t)}))}removeSubscription(t){return new Promise((e=>$t(this,void 0,void 0,(function*(){try{yield this._closeSubscription(t);const r=this.getSubscriptions().length;if(!r){const{error:t}=yield this.realtime.disconnect();if(t)return e({error:t})}return e({error:null,data:{openSubscriptions:r}})}catch(t){return e({error:t})}}))))}_closeSubscription(t){return $t(this,void 0,void 0,(function*(){t.isClosed()||(yield this._closeChannel(t))}))}getSubscriptions(){return this.realtime.channels}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,localStorage:i,headers:n,fetch:s}){const o={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new T({url:this.authUrl,headers:Object.assign(Object.assign({},n),o),autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,localStorage:i,fetch:s})}_initRealtimeClient(t){return new st(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign(Object.assign({},null==t?void 0:t.params),{apikey:this.supabaseKey})}))}_initPostgRESTClient(){return new R(this.restUrl,{headers:this._getAuthHeaders(),schema:this.schema,fetch:this.fetch})}_getAuthHeaders(){var t,e;const r=this.headers,i=null!==(e=null===(t=this.auth.session())||void 0===t?void 0:t.access_token)&&void 0!==e?e:this.supabaseKey;return r.apikey=this.supabaseKey,r.Authorization=`Bearer ${i}`,r}_closeChannel(t){return new Promise(((e,r)=>{t.unsubscribe().receive("ok",(()=>(this.realtime.remove(t),e(!0)))).receive("error",(t=>r(t)))}))}_listenForMultiTabEvents(){if(!this.multiTab||"undefined"==typeof window||!(null===window||void 0===window?void 0:window.addEventListener))return null;try{return null===window||void 0===window?void 0:window.addEventListener("storage",(t=>{var e,r,i;if("supabase.auth.token"===t.key){const n=JSON.parse(String(t.newValue)),s=null!==(r=null===(e=null==n?void 0:n.currentSession)||void 0===e?void 0:e.access_token)&&void 0!==r?r:void 0,o=null===(i=this.auth.session())||void 0===i?void 0:i.access_token;s?!o&&s?this._handleTokenChanged("SIGNED_IN",s,"STORAGE"):o!==s&&this._handleTokenChanged("TOKEN_REFRESHED",s,"STORAGE"):this._handleTokenChanged("SIGNED_OUT",s,"STORAGE")}}))}catch(t){return console.error("_listenForMultiTabEvents",t),null}}_listenForAuthEvents(){let{data:t}=this.auth.onAuthStateChange(((t,e)=>{this._handleTokenChanged(t,null==e?void 0:e.access_token,"CLIENT")}));return t}_handleTokenChanged(t,e,r){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===e?"SIGNED_OUT"!==t&&"USER_DELETED"!==t||(this.removeAllSubscriptions(),"STORAGE"==r&&this.auth.signOut()):(this.realtime.setAuth(e),"STORAGE"==r&&this.auth.setAuth(e),this.changedAccessToken=e)}}let St=class{constructor(e){t(this,e),this.comments=[]}componentWillLoad(){this.supabase=new Ot(this.supabseUrl,this.supabaseKey,undefined),this.getComments(),this.watchComments()}async getComments(){const{data:t}=await this.supabase.from("comments").select().eq("location_id",this.element.id).order("created_at",{ascending:!1});this.comments=t}async watchComments(){await this.supabase.from(`comments:location_id=eq.${this.element.id}`).on("INSERT",(t=>{this.comments=[t.new,...this.comments]})).subscribe()}async addComment(){const{data:t}=await this.supabase.from("comments").insert([{conntet:this.newCommentValue,author:"Author Name",location_id:this.element.id}]);return t}handleChange(t){this.newCommentValue=t.currentTarget.value}handleSubmit(t){t.preventDefault(),this.addComment()}renderComment(t){return e("article",{role:"comment"},e("header",null,e("h1",null,t.author_id)),e("p",null,t.content),e("footer",null,e("small",null,e("time",{dateTime:t.created_at},t.created_at))))}render(){return e(r,null,e("h2",null,"Comments"),e("form",{onSubmit:t=>this.handleSubmit(t)},e("textarea",{rows:5,placeholder:"Add a comment...",value:this.newCommentValue,onChange:t=>this.handleChange(t)}),e("input",{type:"submit",value:"Submit"})),this.comments.map((t=>this.renderComment(t))))}get element(){return i(this)}};St.style=":host{display:block;font-family:sans-serif}article[role='comment']{margin-top:1rem;padding:1rem;border:2px solid black;border-radius:0.5rem;box-shadow:black 5px 5px}form{display:flex;flex-direction:column}form textarea{width:100%;border-radius:5px;border:2px solid lightgray;resize:vertical;padding:0.5rem;box-sizing:border-box}form input[type='submit']{background-color:black;color:white;border:none;border-radius:5px;text-align:start;max-width:min-content;margin-top:0.5rem;padding:0.5rem}";export{St as my_comments}